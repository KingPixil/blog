<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="author" content="Kabir Shah">

		<title>Moon: Pure UI | Blog of Kabir Shah</title>

		<link rel="shortcut icon" href="/img/logo-fill.png"/>
		<link rel="alternate" type="application/json" title="Kabir Shah" href="/feed.json"/>

		<link href="https://fonts.googleapis.com/css?family=Crimson+Pro:400,700|Inconsolata&display=swap" rel="stylesheet"/>
		
		<link rel="stylesheet" type="text/css" href="/css/lib/grain.min.css"/>
		<link rel="stylesheet" type="text/css" href="/css/styles.css"/>

		<script>
			(function(i,s,o,g,r,a,m){i["GoogleAnalyticsObject"]=r;i[r]=i[r]||function(){
				(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
					m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			})(window,document,"script","https://www.google-analytics.com/analytics.js","ga");

			ga("create", "UA-70792533-7", "auto");
			ga("send", "pageview");
		</script>
	</head>

	<body class="a-x-c">
		<a href="/" id="back"><svg width="37" height="24" viewBox="0 0 37 24" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>Arrow</title><path id="back-arrow" d="M36.0607 1.06066c.5857-.585786.5857-1.535534 0-2.12132l-9.546-9.54594c-.5858-.5858-1.5355-.5858-2.1213 0-.5858.5858-.5858 1.53553 0 2.12132L32.8787 0l-8.4853 8.48528c-.5858.58579-.5858 1.53552 0 2.12132.5858.5858 1.5355.5858 2.1213 0l9.546-9.54594zM0 1.5h35v-3H0v3z" transform="rotate(180 18.5 6)" fill="#888" /></svg></a>
		<div class="s-x-26 m-y-5">
			<div>
				<h1 class="s-x-26 a-t-c">Moon: Pure UI</h1>
				<p class="s-x-26 a-t-c">January 12, 2020</p>
			</div>
			<div class="s-x-26 m-y-3">
				<p class="s-x-26"><a href="https://moonjs.org">Moon</a> is a web library that runs applications as pure functions.</p><p class="s-x-26">User interfaces underpin almost all software. As with other programs, they transform and process data. Moreover, they must harmonize users with the underlying computer. People input an endless stream of data, and the application output affects them in real-time.</p><p class="s-x-26">This means that a UI must be responsive and easy to conceptualize. Users interact with the application expecting constant, instant feedback. They want to work with it to solve their problems. The interface is the barrier between the problem and the solution. Users shouldn&#39;t have to wrestle with it. Thus, they should be capable of forming a clear mental representation of the UI.</p><p class="s-x-26">Functional programming, responsiveness, and conceptualization are connected. Pure functions allow both developers and users to visualize input and output states. Being simple to grok means clear implementations, free of scattered imperative code. Clear implementations lead to speed and efficiency.</p><p class="s-x-26">Moon streamlines UI development with pure functions. I&#39;ve lost count of the number of times that I&#39;ve redesigned its API. Every single iteration felt incomplete. Little inconsistencies here and there would leave the perfectionist in me unsatisfied.</p><p class="s-x-26">Other libraries had conditioned me to lean towards similar designs. The mental model that came with React or Vue always found its way into Moon. So, over a week, I erased everything that I knew about user interfaces and tried to create something from scratch.</p><p class="s-x-26">That week grew philosophical as I questioned modern UI development:</p><ul>
<li><p class="s-x-26"><em>Why is view a function of state?</em></p></li><li><p class="s-x-26"><em>Why do we need components?</em></p></li><li><p class="s-x-26"><em>Why do components have local state?</em></p></li><li><p class="s-x-26"><em>If the view is a function of state, what about other effects?</em></p></li></ul>
<p class="s-x-26">Popular UI libraries treat views as functions of state, but UIs aren&#39;t states and views. They&#39;re everything: mapping inputs from the user to outputs on the computer.</p><p class="s-x-26">A UI can take information from the mouse, keyboard, webcam, or mic. After processing this data, it can output to the screen, speakers, network, or hard drive.</p><p class="s-x-26">With this definition, UI becomes a pure function.</p><pre class="s-x-26 s-b-2 p-x-4 p-y-4"><code>application(sensory input) = output signals</code></pre><p class="s-x-26">Four years of reiterating on Moon with complex API rewrites led to this idea. In hindsight, it seems obvious; represent UI as a function. But it can be hard to see through the forest of abstractions in the UI development world. If anything, the simplicity reinforces that functions are a natural way of defining UIs.</p><p class="s-x-26">Pure functions replace contrived models. They interact with the world using drivers. Moon revitalizes UI development with determinism, composition, single state trees, straightforward testing, and faster performance.</p><h2 id="background" class="s-x-26">Background</h2><p class="s-x-26">UI development is drifting away from the Model-View-Controller (MVC) model and mutating views with JQuery. Now, most libraries try to represent the view as a function of state.</p><pre class="s-x-26 s-b-2 p-x-4 p-y-4"><code>application(state) = view</code></pre><p class="s-x-26"><a href="https://reactjs.org">React</a> popularized this idea. For example, a counter application in React stores a count in state and renders it to a view.</p><pre class="s-x-26 s-b-2 p-x-4 p-y-4"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Access state with an magical "hook".</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Return a view.</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>
            <span class="token punctuation">{</span>count<span class="token punctuation">}</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p class="s-x-26">The goal is to represent the view as a pure function of state, but React uses &quot;hooks&quot; instead. Rather than passing global state as a parameter, it links local state to components. Hooks like <code class="s-b-2 p-x-2 p-y-2">useState</code> access this state and store it based on a component&#39;s position in a tree.</p><p class="s-x-26">Local state replacing function parameters means that React apps are not pure. They rely on positions in the tree to store local state, requiring abstractions like keys, context, and state libraries to maintain.</p><p class="s-x-26">The React model also limits UI input to state and output to views. All other inputs and effects are second-class citizens.</p><p class="s-x-26">For example, displaying the time would break out of the functional mental model. It needs input from an impure function and depends on the developer to handle timing effects.</p><pre class="s-x-26 s-b-2 p-x-4 p-y-4"><code><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">Time</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Store time in state.</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>time<span class="token punctuation">,</span> setTime<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Manually handle a timing interval effect.</span>
    <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token function-variable function">interval</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
            <span class="token function">setTime</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token function">setInterval</span><span class="token punctuation">(</span>interval<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">clearInterval</span><span class="token punctuation">(</span>interval<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Return a view based on the time stored in the state.</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLocaleTimeString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre><p class="s-x-26">Most applications need inputs other than state and effects other than views. Even the basic clock UI needs them. React allows writing custom events with the effect hook. But as with all other hooks, writing effects in the body of a function rather than as a return value introduces impurity.</p><p class="s-x-26">Since local state is the sole input, it must store the time. However, this is convoluted. Passing it as an input to the function is clearer.</p><h2 id="drivers" class="s-x-26">Drivers</h2><p class="s-x-26">Computers are imperative, based on operations that mutate the internal state. This includes registers, memory, and other hardware. Until computers treat software as a function, providing inputs and handling outputs, we&#39;ll use drivers.</p><p class="s-x-26">Drivers are an interface between software and hardware. They bridge the gap between functional applications and imperative devices.</p><p class="s-x-26">A driver captures data coming in from devices and sends data back to them. Consequently, in most modern languages, a driver is a module with two functions: one for input and one for output.</p><p class="s-x-26">In an ideal world, a computer would call an application function every cycle. To simulate this, the computer should run the application when inputs change. One can pipe input data from drivers to the application. Then, they can route return values to the appropriate driver output functions.</p><p class="s-x-26">Moon&#39;s <a href="https://github.com/kbrsh/moon/blob/master/packages/moon/src/run.js">run</a> function does this. The implementation (without error handling) is succinct.</p><pre class="s-x-26 s-b-2 p-x-4 p-y-4"><code><span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token parameter">application</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Get inputs from all drivers.</span>
    <span class="token keyword">const</span> input <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> driver <span class="token keyword">in</span> drivers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        input<span class="token punctuation">[</span>driver<span class="token punctuation">]</span> <span class="token operator">=</span> drivers<span class="token punctuation">[</span>driver<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Get the application output.</span>
    <span class="token keyword">const</span> output <span class="token operator">=</span> <span class="token function">application</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Execute drivers with the outputs.</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> driver <span class="token keyword">in</span> output<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        drivers<span class="token punctuation">[</span>driver<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">output</span><span class="token punctuation">(</span>output<span class="token punctuation">[</span>driver<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p class="s-x-26">Each driver is an object with an input and output function. For example, a driver for manipulating RAM, i.e. storing data in a variable is trivial to implement.</p><pre class="s-x-26 s-b-2 p-x-4 p-y-4"><code><span class="token keyword">let</span> data<span class="token punctuation">;</span>

<span class="token keyword">const</span> driver <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">output</span><span class="token punctuation">(</span><span class="token parameter">dataNew</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        data <span class="token operator">=</span> dataNew<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p class="s-x-26">In fact, this is how Moon&#39;s <a href="https://github.com/kbrsh/moon/blob/master/packages/moon/src/data/driver.js">data driver</a> works.</p>
			</div>
			<div class="s-x-26 a-x-sb">
				<p><a href="https://kabir.sh">Portfolio</a></p>
				<p><a href="https://blog.kabir.sh">Blog</a></p>
				<p><a href="https://twitter.com/kbrshah">Twitter</a></p>
				<p><a href="https://github.com/kbrsh">GitHub</a></p>
			</div>
		</div>
	</body>
</html>
